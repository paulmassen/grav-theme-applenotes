{% set notes = page.parent ? page.parent.children().order('date', 'desc') : pages.children().order('date', 'desc') %}
{% set currentSlug = page.slug %}
<div class="sidebar w-[320px] border-r border-muted-foreground/20 h-dvh flex flex-col dark:bg-muted" id="sidebar">
    <div class="w-[320px]">
        {% include 'partials/nav.html.twig' %}
    </div>
    <div class="flex-1 overflow-y-auto" id="sidebar-scroll">
        <div class="flex flex-col w-full">
            <div class="w-[320px] px-2">
                <div class="p-2">
                    <div class="relative">
                        {% if config.plugins.tntsearch.enabled %}
                            {% include 'partials/tntsearch.html.twig' with { 
                            limit: 10,
                            snippet: 100,
                            min: 3,
                            search_type: 'auto',
                            dropdown: true,
                            in_page: true
                        } %}
                        {% endif %}
                    </div>
                </div>
                <div class="py-2" id="notes-list">
                    <nav>
                        {% set groupedNotes = {} %}
                        {% set pinnedNotes = [] %}
                        {% set today = "now"|date("Y-m-d") %}
                        {% set yesterday = "now"|date_modify("-1 day")|date("Y-m-d") %}
                        {% set sevenDaysAgo = "now"|date_modify("-7 days")|date("Y-m-d") %}
                        {% set thirtyDaysAgo = "now"|date_modify("-30 days")|date("Y-m-d") %}
                        {% for note in notes %}
                            {% set noteDate = note.date|date("Y-m-d") %}
                            {% set category = 'older' %}
                            {% if note.header.pinned %}
                                {% set pinnedNotes = (pinnedNotes ?? [])|merge([note]) %}
                            {% elseif noteDate == today %}
                                {% set category = 'today' %}
                            {% elseif noteDate == yesterday %}
                                {% set category = 'yesterday' %}
                            {% elseif noteDate >= sevenDaysAgo %}
                                {% set category = '7' %}
                            {% elseif noteDate >= thirtyDaysAgo %}
                                {% set category = '30' %}
                            {% endif %}
                            {% if not note.header.pinned %}
                                {% if groupedNotes[category] is not defined %}
                                    {% set groupedNotes = (groupedNotes ?? {})|merge({(category): []}) %}
                                {% endif %}
                                {% set groupedNotes = (groupedNotes ?? {})|merge({(category): (groupedNotes[category] ?? [])|merge([note])}) %}
                            {% endif %}
                        {% endfor %}
                        {% if pinnedNotes|length > 0 %}
                            <section>
                                <h3 class="py-1 text-xs font-bold sidebar-category-title ml-2">
                                    ðŸ“Œ Pinned
                                </h3>
                                <ul>
                                    {% for item in pinnedNotes %}
                                        {% include 'partials/note-item.html.twig' with {
                                            'item': item,
                                            'selectedNoteSlug': currentSlug,
                                            'isSearching': false,
                                            'highlightedIndex': 0,
                                            'showDivider': loop.index < pinnedNotes|length
                                        } %}
                                    {% endfor %}
                                </ul>
                            </section>
                        {% endif %}
                        {% set categoryOrder = ['today', 'yesterday', '7', '30', 'older'] %}
                        {% set categoryLabels = {
                            'today': 'Today',
                            'yesterday': 'Yesterday',
                            '7': 'Previous 7 Days',
                            '30': 'Previous 30 Days',
                            'older': 'Older'
                        } %}
                        {% for category in categoryOrder %}
                            {% if groupedNotes[category] is defined and groupedNotes[category]|length > 0 %}
                                <section>
                                    <h3 class="py-1 text-xs font-bold sidebar-category-title ml-2">
                                        {{ categoryLabels[category] }}
                                    </h3>
                                    <ul>
                                        {% for item in groupedNotes[category] %}
                                            {% include 'partials/note-item.html.twig' with {
                                            'item': item,
                                            'selectedNoteSlug': currentSlug,
                                            'isSearching': false,
                                            'highlightedIndex': 0,
                                            'showDivider': loop.index < groupedNotes[category]|length,
                                            'loop': loop
                                        } %}
                                        {% endfor %}
                                    </ul>
                                </section>
                            {% endif %}
                        {% endfor %}
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
.overflow-y-auto {
    overflow-y: auto;
}

.text-base {
    font-size: 1rem;
}

.sm\:text-sm {
    font-size: 0.875rem;
}

.placeholder\:text-sm::placeholder {
    font-size: 0.875rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.pl-8 {
    padding-left: 2rem;
}

.pr-8 {
    padding-right: 2rem;
}

.py-0.5 {
    padding-top: 0.125rem;
    padding-bottom: 0.125rem;
}

.dark\:bg-\[#353533\] {
    background-color: #353533;
}

.dark\:border-none {
    border: none;
}

.absolute {
    position: absolute;
}

.inset-y-0 {
    top: 0;
    bottom: 0;
}

.left-0 {
    left: 0;
}

.right-2 {
    right: 0.5rem;
}

.top-1\/2 {
    top: 50%;
}

.transform {
    transform: translateY(-50%);
}

.-translate-y-1\/2 {
    transform: translateY(-50%);
}

.pointer-events-none {
    pointer-events: none;
}

.hidden {
    display: none;
}

.hover\:text-foreground:hover {
    color: hsl(var(--foreground));
}

.text-xs {
    font-size: 0.75rem;
}

.font-bold {
    font-weight: 700;
}

.ml-2 {
    margin-left: 0.5rem;
}

.py-1 {
    padding-top: 0.25rem;
    padding-bottom: 0.25rem;
}

.sidebar-category-title {
    color: hsl(var(--muted-foreground));
}

.dark .sidebar-category-title {
    color: hsl(var(--muted-foreground));
}
</style>
